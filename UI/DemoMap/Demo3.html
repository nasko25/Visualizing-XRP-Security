<!DOCTYPE html>
<html>
<head>
	<title>EXAMPLE CLUSTER MAP</title>
    <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>    <link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
	<link rel="stylesheet" href="MarkerCluster.Default.css" />
	<script src="leaflet.markercluster-src.js"></script>
    

</head>
<body>

	<div id="mapid" style="width: 600px; height: 400px;"></div>
	<script type="text/javascript">
        var addressPoints = {
            points: [{
                latLng: [50.625073, 9.733887],
                title: "GERMAN VERIFIER",
                trustScore: 0,
                connections: [5, 6]
            },{
                latLng: [50.614617, 9.236633],
                title: "GERMAN NODE",
                trustScore: 1,
                connections: [0, 4]
            },{
                latLng: [50.071244, 8.76709],
                title: "FRANKFURT CENTRAL NODE",
                trustScore: 1,
                connections: [0, 1, 4, 5]
            },{
                latLng: [50.171244, 8.76709],
                title: "A BRADWURST WAGON",
                trustScore: 1,
                connections: [2]
            },{
                latLng: [49.98302, 8.404541],
                title: "MAINZ CENTRAL NODE",
                trustScore: 1,
                connections: [5]
            },{
                latLng: [49.996264, 8.275452],
                title: "MAINZ PROXY",
                trustScore: 1,
                connections: [4]
            },{
                latLng: [49.996264, 8.275452],
                title: "MAINZ PROXY 2",
                trustScore: 1,
                connections: [4]
            },{
                latLng: [51.944265, 4.394531],
                title: "TU DELFT",
                trustScore: 1,
                connections: [4]
            },{
                latLng: [51.910391, 4.460449],
                title: "ROTTERDAM VERIFIER",
                trustScore: 1,
                connections: [4]
            }]
        }
            // var addressPoints = [
            //     [50.625073, 9.733887, "GERMAN VERIFIER", 0, 0],
            //     [50.614617, 9.236633, "GERMAN NODE", 1, 100],
            //     [50.071244, 8.76709, "FRANKFURT CENTRAL NODE", 1, 50],
            //     [50.171244, 8.76709, "A SAUSAGE WAGON", 1, 20],
            //     [49.98302, 8.404541, "MAINZ CENTRAL NODE", 1, 50],
            //     [49.996264, 8.275452, "MAINZ PROXY", 1, 400],
            //     [51.944265, 4.394531, "TU DELFT", 0, 0],
            //     [51.910391, 4.460449, "ROTTERDAM VERIFIER", 1, 1000]];

		var tiles = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {
				maxZoom: 9,
                minZoom: 2,
				attribution: 'NO ATTRIBUTION HAHAHAHAHAHHA'
			}),
			latlng = L.latLng(50.680797, 6.37207);

		var map = L.map('mapid', {center: latlng, zoom: 3, layers: [tiles]});

		var markers = L.markerClusterGroup({
            zoomToBoundsOnClick: false,
            maxClusterRadius: 20
        });
		
		for (var i = 0; i < addressPoints.points.length; i++) {
			var a = addressPoints.points[i];
			var title = a.title;
            var colour = 'green';
            if(a.trustScore==0) colour = 'red';
            var size = 600;
         
			var marker = L.circle(a.latLng, {
                color: colour,
                fillColor: colour,
                 fillOpacity: 0.5,
                radius: size,
                title: title
            });
            
            for(var c = 0; c < a.connections.length; c++){
                var latlngsForLine = Array();
                latlngsForLine.push(a.latLng);
                latlngsForLine.push(addressPoints.points[a.connections[c]].latLng);
                var polyline = L.polyline(latlngsForLine, {color: 'blue'}).addTo(map);
            }
			marker.bindPopup(title);
			markers.addLayer(marker);
		}
        var popup = L.popup();
		map.addLayer(markers);

        markers.on('clusterclick', function (a) {
            
            var children = a.layer.getAllChildMarkers();
            var contentForCluster="<ul>";
            for(var child in children){
                console.log(children[child]);
                contentForCluster+= "<li>"+children[child]._popup._content+"</li>";

            }
            contentForCluster+="</ul>"
            popup
			.setLatLng(a.latlng)
			.setContent(contentForCluster)
			.openOn(map);
        });
        map.on('click', onMapClick);
	</script>
</body>
</html>